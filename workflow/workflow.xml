<openerp>
    <data>

	<!-- workflows -->

        <record model="workflow" id="wkf_create_entry">
            <field name="name">Create Package / Service Workflow</field>
            <field name="osv">product.template</field>
            <field name="on_create">True</field>
        </record>

        <record model="workflow" id="wkf_on_sale_done">
            <field name="name">Create Purchased Package / Service Workflow</field>
            <field name="osv">sale.order</field>
            <field name="on_create">True</field>
        </record>
        
        <!-- removed - moved to scheduler module instead.
        <record model="workflow" id="wkf_deduct_package">
            <field name="name">Deduct Package Upon Creation of Appointment</field>
            <field name="osv">service.scheduler</field>
            <field name="on_create">True</field>
        </record>       
         -->
        <record model="workflow" id="wkf_assign_service">
            <field name="name">Assign Service Quantities Upon Creation of Purchased Package</field>
            <field name="osv">purchased.package</field>
            <field name="on_create">True</field>
        </record>
        
        <record model="workflow" id="wkf_create_timeslots">
            <field name="name">Create Timeslots Upon Creation of Service</field>
            <field name="osv">gv.package.service</field>
            <field name="on_create">True</field>
        </record>

	<!-- activities -->

	<!-- create package and service on product creation -->

        <record model="workflow.activity" id="start">
            <field name="name">Start</field>
            <field name="wkf_id" ref="wkf_create_entry"/>
            <field name="flow_start" eval="True"/>
            <field name="kind">dummy</field>
        </record>

        <record model="workflow.activity" id="create">
            <field name="name">Create</field>
            <field name="wkf_id" ref="wkf_create_entry"/>
            <field name="kind">function</field>
            <field name="action">create_entry()</field>
        </record>

        <record id="stop" model="workflow.activity">
            <field name="wkf_id" ref="wkf_create_entry"/>
            <field name="name">Stop</field>
            <field name="flow_stop">True</field>
        </record>

	<!-- create purchased package and service on sale state = done -->

        <record model="workflow.activity" id="start2">
            <field name="name">Start</field>
            <field name="wkf_id" ref="wkf_on_sale_done"/>
            <field name="flow_start" eval="True"/>
            <field name="kind">dummy</field>
        </record>

        <record model="workflow.activity" id="create2">
            <field name="name">Create</field>
            <field name="wkf_id" ref="wkf_on_sale_done"/>
            <field name="kind">function</field>
            <field name="action">create_on_sale_done()</field>
        </record>

        <record id="stop2" model="workflow.activity">
            <field name="wkf_id" ref="wkf_on_sale_done"/>
            <field name="name">Stop</field>
            <field name="flow_stop">True</field>
        </record>



	<!-- Assign service quantities from gv.package when purchased package is created -->

        <record model="workflow.activity" id="start_assign">
            <field name="name">Start</field>
            <field name="wkf_id" ref="wkf_assign_service"/>
            <field name="flow_start" eval="True"/>
            <field name="kind">dummy</field>
        </record>

        <record model="workflow.activity" id="assign">
            <field name="name">Deduct</field>
            <field name="wkf_id" ref="wkf_assign_service"/>
            <field name="kind">function</field>
            <field name="action">assign_service_quantity()</field>
        </record>

        <record model="workflow.activity" id="stop_assign">
            <field name="wkf_id" ref="wkf_assign_service"/>
            <field name="name">Stop</field>
            <field name="flow_stop">True</field>
        </record>
        
        <!-- Create Timeslots Upon Creation of Service -->

        <record model="workflow.activity" id="start_timeslot">
            <field name="name">Start</field>
            <field name="wkf_id" ref="wkf_create_timeslots"/>
            <field name="flow_start" eval="True"/>
            <field name="kind">dummy</field>
        </record>

        <record model="workflow.activity" id="timeslot">
            <field name="name">Timeslot</field>
            <field name="wkf_id" ref="wkf_create_timeslots"/>
            <field name="kind">function</field>
            <field name="action">generate_timeslots()</field>
        </record>

        <record model="workflow.activity" id="stop_timeslot">
            <field name="wkf_id" ref="wkf_create_timeslots"/>
            <field name="name">Stop</field>
            <field name="flow_stop">True</field>
        </record>
        
	<!-- transitions -->

	<!-- create package and service on product creation -->

        <record id="trans_start_create" model="workflow.transition">
            <field name="act_from" ref="start"/>
            <field name="act_to" ref="create"/>
        </record>

        <record id="trans_create_stop" model="workflow.transition">
            <field name="act_from" ref="create"/>
            <field name="act_to" ref="stop"/>
        </record>

	<!-- create purchased package and service on sale state = done -->

        <record id="trans2_start_create" model="workflow.transition">
            <field name="act_from" ref="start2"/>
            <field name="act_to" ref="create2"/>
            <field name="condition">state=='done'</field>
        </record>

        <record id="trans2_create_stop" model="workflow.transition">
            <field name="act_from" ref="create2"/>
            <field name="act_to" ref="stop2"/>
        </record>


        
    <!-- Move from workflow state to state when purchased package is created, condition = True -->

        <record id="trans_start_assign" model="workflow.transition">
            <field name="act_from" ref="start_assign"/>
            <field name="act_to" ref="assign"/>
            <field name="condition">True</field>
        </record>

        <record id="trans_assign_stop" model="workflow.transition">
            <field name="act_from" ref="assign"/>
            <field name="act_to" ref="stop_assign"/>
        </record>
        
    <!-- Create Timeslots Upon Creation of Service, when condition = True -->

        <record id="trans_start_timeslots" model="workflow.transition">
            <field name="act_from" ref="start_timeslot"/>
            <field name="act_to" ref="timeslot"/>
            <field name="condition">True</field>
        </record>

        <record id="trans_timeslots_stop" model="workflow.transition">
            <field name="act_from" ref="timeslot"/>
            <field name="act_to" ref="stop_timeslot"/>
        </record>
        
    </data>
</openerp>